<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON 파일 읽기 및 POST 요청 (CORS 회피)</title>
    <script>
        let intervalId;

        // 서버로 POST 요청을 보내는 함수 (PHP 파일로 요청 전송)
        function sendPostRequest(data) {
            fetch('./cors_proxy.php', { // PHP 파일 경로
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data), // JSON 파일에서 읽은 데이터
            })
            .then(response => response.json())
            .then(result => console.log('Success:', result))
            .catch(error => console.error('Error:', error));
        }

        // JSON 파일을 읽는 함수
        function readFileAndSendPost() {
            const fileInput = document.getElementById('jsonFile');
            const file = fileInput.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const jsonData = JSON.parse(event.target.result);
                        console.log('파일 내용:', jsonData);

                        const interval = document.getElementById('interval').value;
                        if (intervalId) {
                            clearInterval(intervalId); // 이전 반복을 정지
                        }
                        intervalId = setInterval(() => sendPostRequest(jsonData), interval * 1000);
                        console.log(`POST 요청이 ${interval}초마다 반복됩니다.`);
                    } catch (error) {
                        console.error('JSON 파싱 오류:', error);
                    }
                };
                reader.readAsText(file);
            } else {
                alert('JSON 파일을 선택하세요.');
            }
        }

        // 반복 호출을 정지하는 함수
        function stopRepeatedPost() {
            if (intervalId) {
                clearInterval(intervalId);
                console.log('POST 요청 반복이 중지되었습니다.');
            }
        }
    </script>
</head>
<body>
    <h1>JSON 파일 읽기 및 POST 요청 (CORS 회피)</h1>
    <label for="jsonFile">JSON 파일 선택: </label>
    <input type="file" id="jsonFile" accept=".json">
    <br><br>
    <label for="interval">반복 간격(초): </label>
    <input type="number" id="interval" value="5" min="1">
    <br><br>
    <button onclick="readFileAndSendPost()">반복 시작</button>
    <button onclick="stopRepeatedPost()">반복 중지</button>
</body>
</html>